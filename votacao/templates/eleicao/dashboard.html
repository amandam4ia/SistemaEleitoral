{% extends "base.html" %}

{% block center %}
<main class="dashboard">
    <div class="container">
        <header class="dashboard-header">
            <h1>Elei√ß√µes Dispon√≠veis</h1>
            <p>Participe das elei√ß√µes em andamento e acompanhe os resultados.</p>
        </header>

        <!-- Estat√≠sticas gerais -->
        <div class="stats-overview">
            <div class="stat-card">
                <div class="stat-icon">üìä</div>
                <div class="stat-info">
                    <h3>{{ total_eleicoes }}</h3>
                    <p>Elei√ß√µes Totais</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üó≥Ô∏è</div>
                <div class="stat-info">
                    <h3>{{ eleicoes_abertas }}</h3>
                    <p>Elei√ß√µes Ativas</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">‚úÖ</div>
                <div class="stat-info">
                    <h3>{{ votos_usuario }}</h3>
                    <p>Seus Votos</p>
                </div>
            </div>
        </div>

        {% if user.is_administrador %}
            <a href="{% url 'criar_eleicao'%}" class="btn-primary" style="margin-bottom: 20px">Adicionar Elei√ß√£o</a>
            <a href="{% url 'criar_chapa'%}" class="btn-primary" style="margin-bottom: 20px">Adicionar Chapa</a>
        {% endif %}

        <!-- Lista de elei√ß√µes -->
        <div class="elections-grid">
            {% for eleicao in eleicoes %}
                <div class="election-card 
                    {% if eleicao.status == 'aberta' %}active-election{% elif eleicao.status == 'encerrada' %}finished-election{% else %}upcoming-election{% endif %}">
                    
                    <div class="election-status">
                        {% if eleicao.status == 'aberta' %}
                            <span class="status-badge voting">üî¥ AO VIVO</span>
                            <span class="time-remaining">Termina em {{ eleicao.data_termino|date:"d/m/Y H:i" }}</span>
                        {% elif eleicao.status == 'encerrada' %}
                            <span class="status-badge finished">Finalizada</span>
                            <span class="time-remaining">Encerrada</span>
                        {% endif %}
                        {% if user.is_administrador %}
                            <a href="{% url 'ver_eleicao' eleicao.id %}" class="btn btn-success">Ver Elei√ß√£o</a>
                        {% endif %}
                    </div>

                    <div class="election-content">
                        <h3>{{ eleicao.titulo }}</h3>
                        <p>{{ eleicao.descricao }}</p>

                        <div class="election-meta">
                            <div class="meta-item">
                                <span class="icon">üë•</span>
                                <span>{{ eleicao.contagem_votos }} votos registrados</span>
                            </div>
                            <div class="meta-item">
                                <span class="icon">üìÖ</span>
                                <span>Encerramento: {{ eleicao.data_termino|date:"d/m/Y" }}</span>
                            </div>
                            {% if eleicao.vencedor %}
                            <div class="meta-item">
                                <span class="icon">üèÜ</span>
                                <span>Vencedor: {{ eleicao.vencedor.nome }}</span>
                            </div>
                            {% endif %}
                        </div>

                        <div class="candidates-preview">
                            <span>{{ eleicao.chapas.count }} candidatos:</span>
                            <div class="candidates-avatars">
                                {% for chapa in eleicao.chapas.all|slice:":3" %}
                                    <div class="avatar">{{ chapa.nome|first }}</div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>

                    <div class="election-actions">
                        {% if eleicao.status == 'aberta' %}
                            <a href="{% url 'votar' eleicao.id %}" class="btn-primary">Votar Agora</a>
                        {% elif eleicao.status == 'encerrada' %}
                            <a href="{% url 'resultados' eleicao.id %}" class="btn-primary">Ver Resultado</a>
                        {% else %}
                            <button class="btn-disabled" disabled>Aguardando In√≠cio</button>
                        {% endif %}
                    </div>
                </div>
            {% empty %}
                <p class="no-elections">Nenhuma elei√ß√£o dispon√≠vel no momento.</p>
            {% endfor %}
        </div>
    </div>
</main>
{% endblock %}